# Node.js中的JavaScript

[toc]

## 组成

Node.js中，关于JavaScript主要有四部分组成：

1. ECMAScript

   即Js中的的ECMAScript部分，不包含JS中的DOM和BOM元素。

2. 核心模块

   Node为JavaScript提供了很多服务器级别的API，这些API绝大多数都被包装在了一个个具名的核心模块中。

   例如：文件操作的`fs`核心模块、http服务构建的`http`模块、`path`路径操作模块、`os`操作系统信息模块。。。

   详细了解可查看官网docs：`https://nodejs.org/docs/v` + 版本号 + `/api/`

   笔者所用的node版本为14.17.3，所以docs网址为：`https://nodejs.org/docs/v14.17.3/api/`

3. 第三方模块

   需要通过npm下载进行使用

4. 自定义模块

   开发人员自己编写的模块



## 如何使用模块

大家先简单看一个案例，具体的我们在后面慢慢说。

```javascript
// 引入fs模块
var fs = require("fs");

// 调用fs模块中的readFile函数读取文件
// readFile(path, callback:(error, data) => {})
fs.readFile("./password.txt", (error, data) => {
    if (data) {
        console.log(data);
        console.log(data.toString());
    } else {
        console.log(error);
    }
});
```



## 模块系统

我们都知道，JavaScript本身是不支持模块化的；而Node.js是支持模块化的。

这两者之间有什么区别呢？那首先我们来了解一下什么是模块化。

### 模块化的特点

模块化的特点主要有两个：

1. 文件作用域

2. 通信规则

   * 加载 require

   * 导出 export

     实际上在node的模块中，内置了module.exports对象，作为每个模块的导出对象。



### CommonJS 模块规范

* 模块作用域
* 使用require来加载模块
* 使用exports接口对象用来导出模块对象



## 模块化在Node.js中的详细使用步骤分析

Node.js中的模块实质上就是js文件。

在学习模块化的过程中，主要有两个很重要的东西，require()函数和exports。

require()函数主要用来引入模块，在引入核心模块时，我们只需要在参数中输入模块名称（字符串，使用单引号包裹）。函数会返回一个对象（我将其称之为对象）。我们调用函数时，使用类对象调用模块内的内置函数使用即可。例`fs.readFile()`。

既然知道了require()函数会返回一个对象，那么这个对象是怎么来的呢？

实际上，每个模块文件都是js文件，在文件中会使用JavaScript定义好各种工具函数，然后在该模块中有一个默认存在的对象——exports。在模块的代码中，我们定义exports的某个字段，然后将定义的工具函数赋值给这个字段。当我们想要在外部调用这个函数的时候，只需要使用之前使用require()函数获取的返回值变量（实际上是个对象）调用其内部对应的函数字段即可。

同时，由于exports为一个对象，如果我们在模块中为exports定义一些变量也是可以的，在外部调用时仍可以获取到其值。

明白了上面的原理，我们就可以自定义模块了。那么以下主要说一下自定义模块需要了解的东西：

1. 在自定义模块中，其变量与函数的作用域都仅仅存在模块中，不会扩展到调用的主程序中。（感觉难以理解的话，可以直接将模块理解为静态类。）
2. 在外部调用自定义模块时，只能通过require()函数返回的对象进行调用。
3. require()函数中的参数为模块名称或模块路径，核心模块直接使用模块名称即可，自定义模块则需要使用其模块路径，如果自定义模块与定义模块位于同一路径下，则需要使用`"./xxx"`的形式。若不加`"./"`，编译器/解释器则会将其理解为核心模块，导致无法找到自定义模块。
4. 关于模块名称，可能大家认为核心模块没有后缀，自定义模块有后缀。其实编译器不对后缀进行匹配，自定义模块也可省略`.js`，直接使用模块名称。







## 其他

其实Node.js中并没有什么干货，它所提供的仅仅是一个运行环境，平台。

只要我们学会了JavaScript，对于Node.js的编码那当然是轻而易举。

Node.js提供给我们一种更加轻便的服务器开发方式（当然，仅用于小型项目或测试），这可以让我们更方便的进行模型测试与演示。

所以，Node.js中的JavaScript也并没什么内容。学会使用Node.js，主要是对于Node.js各种模块的灵活运用以及我们的程序设计思维。



